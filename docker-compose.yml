

services:
  documentation:
    image: paxapos-docs-secure:2.0
    container_name: paxapos-docs
    restart: unless-stopped
    ports:
      - "${DOCS_PORT:-3000}:8080"
    environment:
      - NODE_ENV=production
      - TZ=America/Argentina/Buenos_Aires
      - NGINX_WORKER_PROCESSES=auto
    networks:
      - paxapos-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.docs.rule=Host(`docs.paxapos.local`)"
      - "traefik.http.routers.docs.entrypoints=web"
      - "traefik.http.services.docs.loadbalancer.server.port=8080"
    volumes:
      - docs-logs:/var/log/nginx:rw
    security_opt:
      - no-new-privileges:true
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,size=100m
      - /var/cache/nginx:noexec,nosuid,size=50m
      - /var/run:noexec,nosuid,size=10m

  # Servicio de desarrollo (opcional)
  dev:
    build:
      context: .
      dockerfile: Dockerfile
      target: builder
    container_name: paxapos-docs-dev
    profiles:
      - dev
    ports:
      - "${DEV_PORT:-5173}:5173"
    environment:
      - NODE_ENV=development
      - VITE_HMR_PORT=5173
    volumes:
      - .:/app:cached
      - node_modules:/app/node_modules
    command: npm run dev
    networks:
      - paxapos-network

networks:
  paxapos-network:
    name: paxapos
    driver: bridge

volumes:
  docs-logs:
    name: paxapos-docs-logs
  node_modules:
    name: paxapos-docs-node-modules
